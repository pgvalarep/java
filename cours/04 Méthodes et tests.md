---


---

<h1 id="chapitre-4">Chapitre 4</h1>
<h1 id="méthodes-et-tests">Méthodes et tests</h1>
<p>Pour l’instant, nous avons écrit tous nos algorithmes dans la méthodes <code>main</code>. Nous allons maintenant voir comment organiser nos programmes en plusieurs méthodes. Nous verrons aussi comment concevoir des algorithmes tout en les testant.</p>
<h2 id="la-classe-math">La classe <code>Math</code></h2>
<p>La bibliothèque de classes Java inclut une classe <code>Math</code> qui possède les fonctions mathématiques courantes. <code>Math</code> est dans le package <code>java.lang</code> dont l’importation est, rappelons-le, automatique. Quand vous avez besoin d’une fonction mathématique, vérifiez la documentation de la classe <code>Math</code>, il y a des chances que vous trouviez ce que vous cherchez. Nous allons utiliser <code>Math</code> comme support pour l’apprentissage du concept de méthodes. Voici quelques exemples :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">double</span> racineCarre <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">17.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 4.12...</span>
<span class="token keyword">double</span> perimetre <span class="token operator">=</span> <span class="token number">2.0</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI <span class="token operator">*</span> <span class="token number">10.0</span><span class="token punctuation">;</span>   <span class="token comment">// 62.83...</span>
<span class="token keyword">double</span> radians <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">toRadians</span><span class="token punctuation">(</span><span class="token number">180.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3.14...</span>
<span class="token keyword">long</span> entierLePlusProche <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">4.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
</code></pre>
<blockquote>
<p>Notez que <code>Math.PI</code> est une variable (constante !) et non une méthode (pas de parenthèses).</p>
</blockquote>
<h2 id="méthodes-et-expressions">Méthodes et expressions</h2>
<p>Une méthode est une <strong>expression</strong> comme une autre, et elle peut donc être utilisée là où une expression est attendue (du moment que les types sont compatibles), y compris comme argument d’une autre méthode :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">double</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle <span class="token operator">+</span> Math<span class="token punctuation">.</span>PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">exp</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Les méthodes peuvent accepter plus d’un seul argument, séparés par des virgules. <code>printf</code> en est un exemple. <code>Math.pow</code> (calcul de puissance) prend deux arguments :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">double</span> res <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 1024</span>
</code></pre>
<h2 id="définition-de-méthodes">Définition de méthodes</h2>
<p>Certaines méthodes calculent quelque chose et retournent un résultat (ex : <code>Math.pow</code>). D’autres exécutent une procédure sans retourner de résultat (ex : <code>main</code>). Java utilise le mot-clé <code>void</code> pour indiquer qu’une méthode ne retourne rien.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LesMethodes</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">passerALaLigne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Première ligne."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">passerALaLigne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Deuxième ligne."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>La convention Java pour le nommage des classes est le <em>PascalCase</em>. C’est comme le <em>camelCase</em> sauf que la première lettre est aussi en majuscule. La convention pour les noms de méthodes est le <em>camelCase</em>, comme pour les variables.</p>
<p>Ici on a définit, en plus de <code>main</code>, la méthode <code>passerALaLigne()</code>. Vous pouvez utiliser tous les noms que vous voulez pour vos méthodes, alors soyez créatifs : il faut aller au plus court et au plus descriptif. Utiliser un verbe comme premier mot est souvent une bonne pratique (une méthode va <em>faire</em> quelque chose).</p>
<p><code>passerALaLigne</code> et <code>main</code> sont déclarées <code>public</code>, ce qui signifie qu’elle peuvent être <strong>appelées</strong> (on dit aussi <strong>invoquées</strong>) depuis d’autres classes, y compris depuis d’autres packages. Ici <code>passerALaLigne</code> peut être invoquée directement par son nom car elle est définie dans la même classe que l’appelant. Elle est également déclarée comme retournant <code>void</code> à l’appelant, c’est-à-dire rien.</p>
<p>Ce programme va afficher une ligne vide entre les deux lignes de texte. C’est bien sûr à cause de l’appel à <code>passerALaLigne()</code>, qui elle-même appelle <code>println()</code>. On aurait pu appeler plusieurs fois <code>passerALaLigne()</code>, ou bien définir une méthode <code>passerTroisLignes()</code> qui afficherait trois lignes vides. Le programme suivant définit une telle méthode, qui utilise elle-même <code>passerALaLigne()</code> :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LesMethodes</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">passerALaLigne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">passerTroisLignes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">passerALaLigne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">passerALaLigne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">passerALaLigne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Première ligne."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">passerTroisLignes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Deuxième ligne."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="flux-dexécution">Flux d’exécution</h2>
<p>Quand on regarde une classe qui contient plusieurs méthodes, il faut comprendre que l’ordre dans lequel elles sont définies n’a sûrement pas grand-chose à voir avec le <em>flux d’exécution</em> (ordre d’exécution du programme), comme le montre le programme précédent.</p>
<p>Un programme commence toujours à la première instruction de la méthode <code>main</code>, quel que soit l’endroit où celle-ci se trouve dans le code source. Les instructions sont exécutées une à la fois, dans l’ordre, jusqu’à ce qu’on rencontre un appel de méthode, que l’on peut voir comme un « détour » : au lieu d’aller tout de suite à l’instruction suivante, on prend « l’embranchement » de la méthode. On se retrouve ainsi sur la première instruction de la méthode. Puis on exécute une à une les instructions de cette méthode. Quand la dernière instruction d’une méthode a été exécutée, elle se termine et on revient à l’appelant, exactement là où on l’avait laissé. Quand on arrive finalement à la dernière instruction de <code>main</code>, le programme se termine.</p>
<p>Ça peut paraître simpliste, mais n’oubliez pas qu’une méthode peut en appeler une ou plusieurs autres, et elles-même d’autres, et ainsi de suite, multipliant ainsi les embranchements.</p>
<p>Le runtime Java sait évidemment très bien où il en est dans l’exécution du programme, et il est capable de vous dire, quand une erreur d’exécution se produit, le flux d’embranchements qui a mené à cet endroit. C’est ce qu’on appelle la pile d’appels (<em><strong>call stack</strong></em>).</p>
<p>Pourquoi écrire d’autres méthodes alors qu’on pourrait tout placer directement dans <code>main</code> ?</p>
<ol>
<li>Ça permet de <strong>nommer des blocs d’instructions</strong>, ce qui rend le code plus facile à lire.</li>
<li>Ça rend le programme <strong>plus court</strong> en éliminant le code répétitif.</li>
<li>On a déjà parlé de la procédure de développement qui consiste à <strong>découper des problèmes en plusieurs sous-problèmes</strong>. Les méthodes fournissent un moyen pratique d’organiser chaque sous-problème, sous-sous-problème, etc. en isolation.</li>
<li>Cela permet de <strong>tester le comportement de chaque méthode séparément</strong>. Il est plus facile de faire fonctionner un programme complexe si l’on sait que chacune de ses méthodes fonctionne correctement.</li>
</ol>
<h2 id="paramètres-et-arguments">Paramètres et arguments</h2>
<p>Certaines méthodes requièrent des arguments ; ce sont les valeurs que l’on fournit entre parenthèses quand on appelle la méthode. Par exemple, <code>Math.sin</code> prend un argument de type <code>double</code>, à savoir le nombre duquel vous souhaitez connaître le sinus : <code>Math.sin(0.0)</code></p>
<p>Quand on invoque une méthode, on fournit les <strong>arguments</strong> : les valeurs que l’on passe. Quand on définit une méthode, on nomme les <strong>paramètres</strong> : les variables qui recevront, à l’intérieur de la méthode, les valeurs passées en arguments.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParametresEtArguments</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">afficherDeuxFois</span><span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">afficherDeuxFois</span><span class="token punctuation">(</span><span class="token string">"Je ne le répèterai pas !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>La méthode <code>afficherDeuxFois</code> a un <strong>paramètre</strong> appelé <code>message</code> de type <code>String</code>. Donc quand vous l’invoquez, vous devez fournir un <strong>argument</strong> de type <code>String</code>. Si vous ne fournissez pas exactement un argument ou qu’il n’est pas de type <code>String</code>, le compilateur se plaindra.</p>
<p>Quand la méthode est appelée, et juste avant le début de son exécution, <strong>la valeur de l’argument est affecté au paramètre</strong>. Tout se passe exactement comme si on avait défini et initialisé une variable <code>message</code> en tout début de méthode (c’est d’ailleurs exactement ce que fait le compilateur) :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">afficherDeuxFois</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  String message <span class="token operator">=</span> <span class="token string">"Je ne le répèterai pas !"</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Ce processus s’appelle le <strong>passage de paramètres</strong> : les valeurs sont passées depuis l’extérieur de la méthode vers l’intérieur. Un argument (au niveau de l’appelant, donc) peut être n’importe quelle expression, celle-ci sera calculée <em>avant</em> l’appel de la méthode :</p>
<pre class=" language-java"><code class="prism  language-java">String echo <span class="token operator">=</span> <span class="token string">"ECHO"</span><span class="token punctuation">;</span>
<span class="token function">afficherDeuxFois</span><span class="token punctuation">(</span>echo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">afficherDeuxFois</span><span class="token punctuation">(</span><span class="token string">"Pi = "</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span>PI<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">afficherDeuxFois</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Erreur de compilation</span>
</code></pre>
<p>Les paramètres (et autres variables définies dans une méthode) existent seulement à l’intérieur de leur méthode. C’est pourquoi on les appelle des <strong>variables locales</strong>. Dans le programme, la variable <code>message</code> est locale à <code>afficherDeuxFois</code> et est inconnue à <code>main</code>. De même, la variable <code>echo</code> ci-dessus n’est pas accessible depuis <code>afficherDeuxFois</code>.</p>
<p>Voici un autre programme définissant une méthode à deux paramètres :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AffichageHeure</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">afficherHeure</span><span class="token punctuation">(</span><span class="token keyword">int</span> heure<span class="token punctuation">,</span> <span class="token keyword">int</span> minute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>heure<span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>minute<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> heure <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> minute <span class="token operator">=</span> <span class="token number">59</span><span class="token punctuation">;</span>
    <span class="token function">afficherHeure</span><span class="token punctuation">(</span>heure<span class="token punctuation">,</span> minute<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>Quelques erreurs courantes :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">afficherHeure</span><span class="token punctuation">(</span><span class="token keyword">int</span> heure<span class="token punctuation">,</span> minute<span class="token punctuation">)</span>  <span class="token comment">// Type à préciser pour chaque paramètre</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">afficherHeure</span><span class="token punctuation">(</span><span class="token keyword">int</span> heure<span class="token punctuation">,</span> <span class="token keyword">int</span> minute<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// pas de déclaration de types lors de l'invocation</span>
</code></pre>
</blockquote>
<h2 id="diagramme-dappels">Diagramme d’appels</h2>
<p>Dans le programme ci-dessus, des variables <code>heure</code> et <code>minute</code> sont définies à la fois dans <code>main</code> et dans <code>afficherHeure</code> (par l’intermédiaire des paramètres) mais, bien qu’elles aient les mêmes noms, ce ne sont pas les mêmes variables, pas les mêmes emplacement en mémoire.</p>
<p>On peut tracer les appels de méthodes et les arguments correspondants grâce à un diagramme d’appels, qui montre les méthodes en cours d’exécution dans une boîte qui contient les paramètres et les variables locales.</p>
<p>Lee diagramme d’appels est un modèle mental utile pour comprendre les relations variables/méthodes à un certain point de l’exécution. Java Tutor (<a href="http://pythontutor.com/java.html">http://pythontutor.com/java.html</a>) est un outil en ligne qui permet de tracer des programmes entiers (même en reculant) et de voir le diagramme d’appels à chaque étape.</p>
<h2 id="valeurs-de-retour">Valeurs de retour</h2>
<p>Quand on invoque une méthode retournant <code>void</code>, l’appel est en général l’unique instruction de la ligne : <code>afficherHeure(heure, minute);</code>. Une méthode retournant <code>void</code> est en effet une expression qui ne peut pas être incluse dans le calcul d’une expression englobante.</p>
<p>En revanche,  quand on invoque une méthode qui a une valeur de retour, vous pouvez (et en général vous devez) faire quelque chose de cette valeur de retour : elle peut être utilisée dans une expression ou directement assignée à une variable :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">double</span> decalage <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>nombre1 <span class="token operator">-</span> nombre2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> hauteur <span class="token operator">=</span> rayon <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Par rapport à une méthode <code>void</code>, les méthodes retournant une valeur ont deux différences :</p>
<ol>
<li>Elles indiquent le type de la valeur de retour (<strong>type de retour</strong>, <em><strong>return type</strong></em>)</li>
<li>Elles utilisent au moins une instruction <code>return</code> pour produire une <strong>valeur de retour</strong> (<em><strong>return value</strong></em>)</li>
</ol>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">calculerSurface</span><span class="token punctuation">(</span><span class="token keyword">double</span> rayon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> res <span class="token operator">=</span> Math<span class="token punctuation">.</span>PI <span class="token operator">*</span> rayon <span class="token operator">*</span> rayon<span class="token punctuation">;</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Comme d’habitude, la méthode est déclarée <code>public</code> et <code>static</code>. Mais au lieu de <code>void</code>, il y a un type, <code>double</code> : c’est le type de retour.</p>
<p>L’instruction <code>return expr</code> signifie : <em>sort immédiatement de cette méthode et retourne à l’appelant la valeur de l’expression <code>expr</code></em>. L’expression retournée peut être arbitrairement complexe, elle sera calculée avant la sortie. Ici, le corps de la méthode pouvait donc tenir en une seule instruction :</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">return</span> Math<span class="token punctuation">.</span>PI <span class="token operator">*</span> rayon <span class="token operator">*</span> rayon<span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>Néanmoins, l’utilisation d’une variable temporaire (ici <code>res</code>) pourra rendra l’examen de la valeur de l’expression calculée plus facile lors d’une phase de <em>debugging</em>.</p>
</blockquote>
<p>Le type de l’expression retournée doit correspondre au type de retour de la méthode. Sinon, le compilateur vous tapera sur les doigts.</p>
<h2 id="développement-incrémental">Développement incrémental</h2>
<p>Les développeurs font parfois l’erreur d’écrire beaucoup de code avant de tester quoi que ce soit. Les méthodes s’accumulent et quand on finit par lancer le programme, il est plus difficile de localiser les erreurs qui ne manqueront pas de se produire. Une meilleure approche est celle du <strong>développement incrémental</strong> :</p>
<ul>
<li>On démarre avec un code qui fonctionne, on effectue de petits ajouts, et on teste. <strong>À tout moment, si une erreur se produit, vous savez qu’elle vient de ce que vous venez d’ajouter</strong>.</li>
<li>On utilise des variables pour stocker des valeurs intermédiaires pour pouvoir les visualiser facilement (avec des instructions <code>print</code> ou avec le <em>debugger</em>).</li>
<li>Une fois que le programme (ou la méthode) fonctionne, on « nettoie » le code pour le rendre le plus lisible possible, toujours en testant.</li>
</ul>
<p>Supposons que nous devions concevoir une méthode qui calcule la distance entre deux points (<em>x1, y1</em>) et (<em>x2, y2</em>).</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>=</mo><msqrt><mrow><mo>(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><msup><mo>)</mo><mn>2</mn></msup><mo>+</mo><mo>(</mo><msub><mi>y</mi><mn>2</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><msup><mo>)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">
distance = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.24em; vertical-align: -0.256125em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.983875em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.94388em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"><svg width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.256125em;"><span class=""></span></span></span></span></span></span></span></span></span></span></p>
<ol>
<li>Quelles sont les entrées (les paramètres) ? Elle aura besoin des coordonnées des deux points, naturellement représentées par des <code>double</code>.</li>
<li>Quelle est la sortie (<code>void</code> ou bien type de retour) ? Elle devra retourner la distance calculée, qui sera également un <code>double</code>.</li>
<li>On commence à écrire la méthode minimale qui répond à tout ça et qui compile (appelée <em><strong>stub</strong></em>) :</li>
</ol>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">calculerDistance</span><span class="token punctuation">(</span><span class="token keyword">double</span> x1<span class="token punctuation">,</span> <span class="token keyword">double</span> x2<span class="token punctuation">,</span> <span class="token keyword">double</span> y1<span class="token punctuation">,</span> <span class="token keyword">double</span> y2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ol start="4">
<li>On teste l’appel de méthode en l’invoquant dans la méthode <code>main</code> avec des paramètres pour lesquels on connaît le résultat attendu :</li>
</ol>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// devrait retourner 5.0</span>
  <span class="token keyword">double</span> dist <span class="token operator">=</span> <span class="token function">calculerDistance</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">,</span> <span class="token number">6.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ol start="5">
<li>Pour l’instant ça ne fonctionne pas bien sûr, mais tout est en place ; il n’y a « plus qu’à » <strong>implémenter</strong> la méthode (écrire le code qui correspond à la fonctionnalité), petit à petit. On commence par calculer et stocker les différences <code>x2 - x1</code> et <code>y2 - y1</code> dans des variables temporaires pour pouvoir les afficher (test) :</li>
</ol>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">calculerDistance</span><span class="token punctuation">(</span><span class="token keyword">double</span> x1<span class="token punctuation">,</span> <span class="token keyword">double</span> x2<span class="token punctuation">,</span> <span class="token keyword">double</span> y1<span class="token punctuation">,</span> <span class="token keyword">double</span> y2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> dx <span class="token operator">=</span> x2 <span class="token operator">-</span> x1<span class="token punctuation">;</span>
  <span class="token keyword">double</span> dy <span class="token operator">=</span> y2 <span class="token operator">-</span> y1<span class="token punctuation">;</span>
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dx = "</span> <span class="token operator">+</span> dx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dy = "</span> <span class="token operator">+</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ol start="6">
<li>On continue en ajoutant incrémentalement des variables pour calculer la somme des carrés puis la racine carrée de cette somme.</li>
</ol>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">calculerDistance</span><span class="token punctuation">(</span><span class="token keyword">double</span> x1<span class="token punctuation">,</span> <span class="token keyword">double</span> x2<span class="token punctuation">,</span> <span class="token keyword">double</span> y1<span class="token punctuation">,</span> <span class="token keyword">double</span> y2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> dx <span class="token operator">=</span> x2 <span class="token operator">-</span> x1<span class="token punctuation">;</span>
  <span class="token keyword">double</span> dy <span class="token operator">=</span> y2 <span class="token operator">-</span> y1<span class="token punctuation">;</span>
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dx = "</span> <span class="token operator">+</span> dx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"dy = "</span> <span class="token operator">+</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> somme <span class="token operator">=</span> dx <span class="token operator">*</span> dx <span class="token operator">+</span> dy <span class="token operator">*</span> dy<span class="token punctuation">;</span>
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"somme = "</span> <span class="token operator">+</span> somme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> dist <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>somme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ol start="7">
<li>Maintenant que cela semble fonctionner (en tout cas pour ces valeurs de test), on nettoie la méthode en enlevant toutes les instructions d’affichage et éventuellement en enlevant des variables intermédiaires que l’on juge inutiles à la lisibilité ; on veille aussi à bien retourner le résultat :</li>
</ol>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">calculerDistance</span><span class="token punctuation">(</span><span class="token keyword">double</span> x1<span class="token punctuation">,</span> <span class="token keyword">double</span> x2<span class="token punctuation">,</span> <span class="token keyword">double</span> y1<span class="token punctuation">,</span> <span class="token keyword">double</span> y2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> dx <span class="token operator">=</span> x2 <span class="token operator">-</span> x1<span class="token punctuation">;</span>
  <span class="token keyword">double</span> dy <span class="token operator">=</span> y2 <span class="token operator">-</span> y1<span class="token punctuation">;</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>dx <span class="token operator">*</span> dx <span class="token operator">+</span> dy <span class="token operator">*</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>À mesure que vous gagnerez en expérience, vous pourrez augmenter le nombre d’instructions que vous ajouterez entre les tests, parce que vous serez suffisamment confiant que ce que vous écrivez est correct. Mais le développement incrémental restera une bonne technique à utiliser.</p>

